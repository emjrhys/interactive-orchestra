<!DOCTYPE html>
<html>
    <head>
        <title>Interactive Orchestra</title>
        <link rel="stylesheet" type="text/css" href="main.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
    </head>
    <body>
        <audio id="track" src="assets/afterthestorm.mp3" ontimeupdate="getTime();">
            <p>Your browser does not support the audio element! Please use another browser for the full experience</p>
    </audio>
        <div id="main-container">
            <div id="duration"></div>
            <div class="splash">
                <button id="play"></button>
            </div>
            <button id="stop"></button>
            <div class="inst harp" title="harp"></div>
            <div class="inst cello" title="cello"></div>
        </div>

    
        <script>
            $(document).ready(function() {
                var selected = "";
                var playing = false;
                
                function getTime() {
                    var music = document.getElementById("track");
                    $("#duration").append((Math.floor(music.currentTime) + ' / ' + Math.floor(music.duration) + "<br/>"));
                }

                                    
                $("#play").click(function() {
                    if (!playing) {
                        $(".splash").addClass("playing");
                        document.getElementById('track').play();
                        playing = true;
                        move();

                        setTimeout(function() {
                            $("#stop").addClass("playing");
                        }, 12500);
                    }
                });

                $("#stop").click(function() {
                    if (playing) {
                        playing = false;
                        document.getElementById('track').pause();
                        $(this).css("background", "url(assets/play_small.gif) no-repeat center center");
                    }
                    else {
                        playing = true;
                        move();
                        document.getElementById('track').play();
                        $(this).css("background", "url(assets/stop.gif) no-repeat center center");

                    }
                });

                function move() {
                    $(".inst").each(function(index) {
                        if ($(this).attr("title") != selected) {
                            $(this).css("top", "-=1px");
                        }
                    });
                    if (playing) setTimeout(move, 12);
                }


                $(".inst").click(function() {
                    var title = $(this).attr("title");

                    if (title == selected) selected = "";
                    else selected = title;
                });
            });
        </script>
    </body>
</html>
